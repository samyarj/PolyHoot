<div class="main-wrapper">
    <div #previousMessages id="previous-messages" (scroll)="onScroll()">
        <div *ngIf="chatMessagesLoading" class="loading-container">
            <div class="spinner-border text-primary" role="status"></div>
            <div>Chargement du clavardage</div>
        </div>
        <div *ngIf="chatMessages.length === 0 && !chatMessagesLoading">Écrivez un message pour débuter le clavardage!</div>

        <div
            *ngFor="let chatmessage of chatMessages"
            [ngClass]="{
                systemMessage: chatmessage.author === 'System',
                user: (user | async)?.username === chatmessage.author,
                otherUser: (user | async)?.username !== chatmessage.author
            }"
            class="chat-message user otherUser"
        >
            <div class="chat-header">
                <app-avatar-banner [avatarUrl]="chatmessage.avatar" [bannerUrl]="chatmessage.border" class="chat-avatar"> </app-avatar-banner>
                <span class="chat-username">{{ chatmessage.author }}</span>
                <div
                    *ngIf="(user | async)?.username !== chatmessage.author && chatmessage.uid"
                    class="report-button"
                    (click)="reportUser(chatmessage.uid, chatmessage.author)"
                    matTooltip="Signaler"
                    matTooltipClass="custom-tooltip"
                >
                    <i class="fa-solid fa-triangle-exclamation"></i>
                </div>
            </div>
            <div class="message">{{ chatmessage.message }}</div>
            <div class="date-container">
                <div class="time">{{ chatmessage.date | date: 'HH:mm:ss' }}</div>
            </div>
        </div>
    </div>
    <div id="chat-message-input-div">
        <textarea
            id="myTextInput"
            (keydown)="onKeyDown($event)"
            placeholder="Entrez votre message."
            [(ngModel)]="inputMessage"
            maxlength="200"
        ></textarea>
        <button
            type="button"
            [disabled]="inputMessage === ''"
            [ngClass]="{ 'custom-button-disabled': inputMessage === '' }"
            class="custom-button"
            id="send-button"
            (click)="sendMessageToRoom()"
        >
            Envoyer
        </button>
    </div>
    <span class="error" *ngIf="inputMessage.length === 200"> Attention ! Limite de 200 caractères atteinte </span>
</div>
